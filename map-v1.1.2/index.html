<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="TCS.webp" type="image/png">
    <title>TerritoryConquestSimulator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="container">
        <!-- キャンバスエリア -->
        <canvas id="mapCanvas" width="800" height="600"></canvas>
        <!-- サイドバー -->
        <div id="sidebar">
            <a href="../index.html" id="homeIcon">
                <img src="TCS.webp" alt="ホームアイコン">
            </a>
            <h3>TerritoryConquestSimulator</h3>
            <!-- タブメニュー -->
            <div id="tabMenu">
                <button class="tabButton" onclick="showTab('settingsTab')">地図設定</button>
                <button class="tabButton" onclick="showTab('statusTab')">地図状況</button>
                <button class="tabButton" onclick="showTab('infoTab')">説明</button>

            </div>
            
            <!-- 地図設定タブの内容 -->
            <div id="settingsTab" class="tabContent">
                <h2>地図設定</h2>
                <br>
                <h3>プリセット</h3>
                <button onclick="applyPreset('default')">デフォルト設定</button>
                <button onclick="applyPreset('large')">大きな地図</button>
                <button onclick="applyPreset('dense')">もっと大きな地図</button>
                <button onclick="applyPreset('random')">ランダムパターン</button>
                <button onclick="applyPreset('test')">テスト用パターン</button>
                                
                <div id="specialGeneration">
                    <h3>特殊生成リスト</h3>
                    <button onclick="applySpecialGeneration('whiteWithFourColors')">四つ巴 (White with Blue, Red, Green, Yellow)</button>
                    <button onclick="applySpecialGeneration('battleRoyale')">バトロアモード (100 Random Colors)</button>
                </div>


                <br>
                <h3>領地設定</h3>
                <label for="capitalToggle">首都を設置する</label>
                <input type="checkbox" id="capitalToggle"><br>
                <label for="cityToggle">都市を配置する</label>
                <input type="checkbox" id="cityToggle">
                <div id="cityRequirementContainer" style="display: none;">
                    <label for="cityRequirement">都市を配置するのに必要な<br>最低のステート数:</label>
                    <input type="number" id="cityRequirement" value="10" min="1">
                </div><br>

                <br>
                <h3>地図操作</h3>
                <button id="saveButton">設定を保存</button>
                <button id="loadButton">設定をロード</button><br>

                <label for="numCells">ステートの数: </label>
                <input type="number" id="numCells" value="1000" min="10" max="10000"><br>

                <label for="mergeIterations">吸収回数: </label>
                <input type="number" id="mergeIterations" value="0" min="1" max="500"><br>

                <label for="tickInterval">吸収間隔 (ミリ秒): </label>
                <input type="number" id="tickInterval" value="50" min="10" max="10000"><br>

                <button id="regenerateButton">再生成</button>

                <button id="singleMergeButton">吸収を一回実行</button>
                <button id="multiMergeButton">指定数吸収を実行</button>
                <button id="toggleAutoMergeButton">自動吸収開始/停止</button><br>

                <label for="randomAbsorptionToggle">たまにランダム吸収を挟む</label>
                <input type="checkbox" id="randomAbsorptionToggle"><br>

                <label for="absorptionPattern">吸収パターン: </label>
                <select id="absorptionPattern">
                    <!-- <option value="random">ランダム吸収</option> -->
                    <option value="majority">多数決吸収(安定しやすい)</option>
                    <option value="weighted" selected>重み付き吸収</option>
                    <option value="combined">重み付き多数決吸収</option>
                    <option value="modified-weighted" id="modifiedWeightedOption" >修正重みつき吸収</option>
                    <option value="global-modified-weighted" id="modifiedWeightedOption" >全体修正重みつき吸収</option>
                    <option value="custom-weighted" id="modifiedWeightedOption" >分配修正全体重み付き吸収</option>
                </select><br>

                <br>
                <h3>表示設定</h3>
                <label for="showBordersOnlyToggle">国境のみに線を表示</label>
                <input type="checkbox" id="showBordersOnlyToggle">
                <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
            </div>

            <!-- 地図状況タブの内容 -->
            <div id="statusTab" class="tabContent" style="display: none;">
                <h2>地図状況</h2>
                <label for="topCount">表示する上位数:</label>
                <input type="number" id="topCount" value="10" min="1" style="width: 60px;">
                <button onclick="updateColorRanking()">ランキング更新</button>
            
                <div id="colorRanking">
                    <div id="rankingList"></div>
                </div>

                <label for="logLimit">地図ログの保存数:</label>
                <input type="number" id="logLimit" value="100" min="10" style="width: 60px;">
                <div id="mapLog">
                    <h3>地図ログ</h3>
                    <ul id="logList"></ul>
                </div>
                <br>
                <div id="colorAdjacencyRanking">
                    <h3>接している色ランキング</h3>
                    <table id="adjacencyTable" border="1">
                        <thead>
                            <tr>
                                <th>順位</th>
                                <th>色</th>
                                <th>接している色数</th>
                                <th>隣接色</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- ランキングデータがここに挿入されます -->
                        </tbody>
                    </table>
                </div>
                
                <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
            </div>

            <!-- 説明タブの内容 -->
            <div id="infoTab" class="tabContent" style="display: none;">
                <h2>使い方</h2>
                <h2>地図設定</h2>
                <h3>プリセット</h3>
                <p>製作者が実験で使ったりするプリセットです。<br>ランダムプリセットはランダムな設定に変わります。</p>
                <h3>領地設定</h3>
                <p>首都は赤い枠で囲われているステートのことを指します。それが他の色に奪われると滅亡してしまいます。</p>
                <p>その際、都市（青い枠がつくステート）がある場合、首都を都市に移転させます。</p>
                <h3>地図操作</h3>
                <p>吸収回数は再生成をした時に元から何回吸収工程を踏むかを示します。</p>
                <p>指定数吸収は吸収回数を参照して吸収します。</p>
                <h3>吸収パターン</h3>
                <dev>
                    <!-- <b>ランダム吸収:</b><br><p>ランダムに吸収します。</p> -->
                    <b>多数決吸収:</b><br><p>自分に接する最も多いステートに変わります。</p>
                    <b>重み付き吸収:</b><br><p>自分に接するステートを数え上げ、多い順にランダムに変わります。</p>
                    <b>修正重み付き吸収:</b><br><p>重み付き吸収に加え、ステートの差が圧倒的な場合はそのステートに変わります。</p>
                    <b>全体修正重み付き吸収:</b><br><p>修正重み付き吸収に加え、地図の全てのステートの数を関連させて動きます。多ければ強いです。</p>
                </dev>
                <h3>表示設定</h3>
                <p>色の違うステートの間にのみ黒い線を描きます。</p>
                <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
            </div>

            <!-- バージョン表示 -->
            <div id="versionLabel">陣取り合戦シミュレータ v1.1.2<br>by ChatGPT & Aotumuri</div>
        </div>
    </div>

    <!-- d3-delaunay CDN -->
    <script src="https://unpkg.com/d3-delaunay@6/dist/d3-delaunay.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
